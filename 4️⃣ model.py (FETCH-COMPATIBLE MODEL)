import torch
import torch.nn as nn

class FetchTableSetupModel(nn.Module):
    def __init__(self, state_dim=30):
        super().__init__()
        self.net = nn.Sequential(
            nn.Linear(state_dim, 256),
            nn.ReLU(),
            nn.Linear(256, 256),
            nn.ReLU(),
            nn.Linear(256, 256),
            nn.ReLU(),
            nn.Linear(256, 13),
            nn.Tanh()
        )

    def forward(self, obs):
        if isinstance(obs, dict):
            if "agent" in obs:
                state = obs["agent"]
            else:
                state = torch.cat(
                    [v.flatten() for v in obs.values()], dim=-1
                )
        else:
            state = obs

        if len(state.shape) == 1:
            state = state.unsqueeze(0)

        return self.net(state)
